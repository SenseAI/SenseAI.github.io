<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/fonts.css" media="print">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <link rel="stylesheet" type="text/css" href="stylesheets/syntax.css" media="screen">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Sense AI Documentation</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <img src="//d3r46qqpc6jz4w.cloudfront.net/senseai/SenseAi_logo.svg">
        <h2>API/SDK Documentation</h2>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content" class="markdown-body">
          <h1 id="api-documentation">API Documentation</h1>

<h2 id="general">General</h2>

<h3 id="conventions">Conventions</h3>

<h4 id="authentication">Authentication</h4>

<p>Where required, Basic Auth is used for user/developer level api access.</p>

<h4 id="time">Time</h4>

<p>Where timestamps are required either an ISO-8601 date string or a milliseconds-since-epoch(UTC), can be used interchangeably</p>

<h3 id="documentation-code-examples">Documentation Code Examples</h3>

<p>Throughout the API documentation we use the python(2) language to illustrate example usage.  For the examples to work the following imports are necessary:</p>

<pre><code class="language-python">import requests
import time
import datetime
</code></pre>

<p>We use <a href="http://docs.python-requests.org/en/latest/">requests</a> for the http library in these examples, the features used are expected to be present in most mature http libraries in popular languages.</p>

<h3 id="resource-descriptors">Resource Descriptors</h3>

<p>It is useful to too look at how SenseAI’s backend resources are organized, in order to understand the possibilites for resource access.  The resource relationships visible to the developer can be summed up as follows:</p>

<p><strong>users</strong> <em>have</em> <strong>applications</strong> : a user who is a developer can create applications(which represent a mobile device application which embeds an SDK), each of these are identified by an api_key, which are used to initiate the SDK along with the user_id</p>

<p><strong>application</strong> <em>have</em> <strong>environments</strong> : for each application, each device which uses an instance of the SDK is referred to as an environment, this environment tracks and identifies the mobile devices</p>

<p><strong>user</strong> <em>have</em> <strong>environments</strong> : users can link environments to their account through a pin challenge, this is used for individual app users to view their own data from the usage of senseAI APIs</p>

<p><strong>environments</strong> <em>have</em> <strong>data</strong> : each environment generates timestamped data</p>

<p>These relationships create the following possible resource descriptors:</p>

<p><code>/user/:user_id/</code><br />
<code>/user/:user_id/environment/:environment_id/</code><br />
<code>/user/:user_id/environment/:environment_id/data</code><br />
<code>/user/:user_id/environments</code><br />
<code>/user/:user_id/application/:application_id/</code><br />
<code>/user/:user_id/applications</code><br />
<code>/user/:user_id/application/:application_id/environment/:environment_id</code><br />
<code>/user/:user_id/application/:application_id/environment/:environment_id/data</code><br />
<code>/user/:user_id/application/:application_id/environments</code></p>

<h3 id="response-envelope">Response Envelope</h3>

<p>All response bodies are JSON encoded.  All JSON responses have a standard response envelope, that can be used to obtain meta-data about the response, in addition to the message payload.  An example for <code>GET /user/_</code> is seen below.</p>

<h4 id="example-response">Example Response</h4>

<pre><code class="language-json">{
  "links": {
    "self": "https://senseai-staging.com/api/v2/user/_/"
  },
  "status": {
    "code": 200,
    "text": "OK"
  },
  "error": null,
  "message": {
    "user": {
      "id": "f507b1fa6bb4916b555816e89e7cea03",
      "email": "foo@bar.com",
      "roles": [
        "user",
        "developer:basic"
      ],
      "unit_preference": "imperial",
      "created": 1432655398966,
    }
  }
}
</code></pre>

<h4 id="response-envelope-keys">Response Envelope Keys</h4>

<table>
  <thead>
    <tr>
      <th><strong>key</strong></th>
      <th><strong>description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>links.self</td>
      <td>a canonical version of the resource being accessed</td>
    </tr>
    <tr>
      <td>links.next</td>
      <td>if the resource has multiple parts, the link to the next part</td>
    </tr>
    <tr>
      <td>status.code</td>
      <td>same as the http response status code</td>
    </tr>
    <tr>
      <td>status.text</td>
      <td>the description of the http response status code</td>
    </tr>
    <tr>
      <td>error</td>
      <td>if an error occurred, a description of that error</td>
    </tr>
    <tr>
      <td>message</td>
      <td>the payload of the resource accessed (typically this is what you want)</td>
    </tr>
  </tbody>
</table>

<h3 id="pagination">Pagination</h3>

<p>For large collections of resources pagination is necessary.  Two query params control pagination in resources with plurality: <code>limit</code> determines the number of items returned at a time, <code>offset</code> is the id of the last item obtained by the caller.  If the <code>links.next</code> field exists in the response body, that link (constructed using limit and offset) can be followed in order to obtain the next set of items.  Pagination terminates when links.next is undefined.  See List Environment Example below for a code example.</p>

<h2 id="api-routes">API Routes</h2>

<h3 id="list-device-compatibility">List Device Compatibility</h3>

<p>Get a list of SDK compatible devices, ones for which software sensors have been calibrated.</p>

<h4 id="url">URL</h4>

<pre><code>GET https://senseai.io/api/v2/device/compat
</code></pre>

<h4 id="options">Options</h4>

<table>
  <thead>
    <tr>
      <th>query param</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>onlyTempV2</td>
      <td>only show entries which are calibrated V2 Temperature Model</td>
    </tr>
  </tbody>
</table>

<h4 id="response">Response</h4>

<p>example response message</p>

<pre><code class="language-json">[
	{
		"id":"23bb76f0-482b-11e5-a230-95b571d65c97",
		"name":"OnePlus One",
		"osVersion":"&lt;5.0.0",
	}, ...
]
</code></pre>

<h4 id="example-code">Example Code</h4>

<pre><code class="language-python">url = '{}/device/compat'.format(base_url)
params = { 'onlyTempV2' : 'yes' }

r = requests.get(url, params=params)

if not r.status_code==200:
	raise Exception('an error occurred')

devices = r.json()['message']['devices']

print 'Supported Devices'

for device in devices:
	print '\t' + device['name'] + ' ' + device['osVersion']
</code></pre>

<p>outputs:</p>

<pre><code>Supported Devices
	Samsung Galaxy S5 4.4.2
	Samsung Galaxy S5 &gt;=5.0
	Samsung Galaxy S5 4.4.4
	Samsung Galaxy S4  *
</code></pre>

<h3 id="list-environments-for-an-application">List Environments for an Application</h3>

<p>List the environments registered with an api_key.  This requires pagination since this list can be quite large depending on the distribution of an app using sdk.</p>

<h4 id="url-1">URL</h4>

<pre><code>GET https://senseai.io/api/v2/user/:user_id/application/:application_id/environments
</code></pre>

<h4 id="response-1">Response</h4>

<p>example response message</p>

<pre><code class="language-json">[
	{
	  "id": "63d41b25c634c6aef3852d3ecd03879e.FED2E1F1F1CE09667A891A55E1E7D1DA",
	  "updated": 1445871149421,
	  "model": "t0lte",
	  "device_id": "2bb9f350-4203-11e5-b07c-71c60df92d2d",
	  "sdk_version": "0.6.0",
	  "api_key": "63d41b25c634c6aef3852d3ecd03879e",
	  "client_id": "FED2E1F1F1CE09667A891A55E1E7D1DA",
	  "timestamp": 1445867995878,
	  "commercial_name": "Samsung Galaxy Note2",
	  "os_version": "4.1.2"
	},
	...
]
</code></pre>

<h4 id="example">Example</h4>

<pre><code class="language-python">
url = '{}/api/v2/user/_/application/{}/environments'.format(base_url,api_key)

environment_ids = []

while True:

	r = requests.get(url,auth = (username,password))

	if not r.status_code==200:
		raise Exception(r.status_code)

	body = r.json()

	environment_ids += [ e['id'] for e in body['message']['environments'] ]

	if 'next' in body['links']:
		url = body['links']['next']
	else:
		break

for e_id in environment_ids:
	print e_id

</code></pre>

<p>outputs:</p>

<pre><code>63d41b25c634c6aef3852d3ecd03879e.0107D0DF2157D7EC4552C1B0D6A691BF
63d41b25c634c6aef3852d3ecd03879e.117D788E7A5A61DD32BBF4619F73AFA5
63d41b25c634c6aef3852d3ecd03879e.2C49FD6AB5C58975961B18E773097646
63d41b25c634c6aef3852d3ecd03879e.8E3B20F445235E6DB92C132D5408B6E4
63d41b25c634c6aef3852d3ecd03879e.9383AB36613529BE35CB2F818C3049B5
63d41b25c634c6aef3852d3ecd03879e.96BD8335CDC067E1B5461EDAA270672B
63d41b25c634c6aef3852d3ecd03879e.A5BADB55D70CFA1D7B33A34F99AD44DD
...
</code></pre>

<h3 id="query-data-from-an-environment-in-an-application">Query Data from an Environment in an Application</h3>

<h4 id="url-2">URL</h4>

<pre><code>GET https://senseai.io/api/v2/user/:user_id/application/:application_id/environment/:environment_id/data
</code></pre>

<h4 id="options-1">Options</h4>

<table>
  <thead>
    <tr>
      <th>parameter</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>start</strong></td>
      <td>beginning of time indexed window (ISO or unix time allowed)</td>
    </tr>
    <tr>
      <td><strong>end</strong></td>
      <td>end of time indexed window</td>
    </tr>
    <tr>
      <td><strong>limit</strong></td>
      <td>pagination: the number of data points to return (default is 20, max is 100)</td>
    </tr>
    <tr>
      <td><strong>order</strong></td>
      <td>‘descending’ or ‘ascending’ (default is descending, accepts any abbreviations)</td>
    </tr>
  </tbody>
</table>

<h4 id="response-2">Response</h4>

<p>example response message:</p>

<pre><code class="language-json">[
	{  
	   "environment_id":"63d41b25c634c6aef3852d3ecd03879e.E668B385B50BE3ED3B4A128F6A3D2455",
	   "time":"2015-10-26T18:38:05.136Z",
	   	"location":{  
	      "longitude":3.6662295,
	      "latitude":43.3977541,
	      "accuracy":35.19900131225586
	   },
	   "derived_sensors":{  
	      "temperature":{  
	         "value":20.622745768229166,
	         "confidence":0.9999999963628308
	      }
	   },
	   "normalized_sensors":{  
	      "lux":{  
	         "value":0.36372525855
	      }
	   },
	   "raw_sensors":{  
	      "average_sman_pressure":{  
	         "value":1012.5
	      },
		  "average_sman_humidity":{  
		         "value":73.55426205721768
		  }
	   }
	}
	...
]
</code></pre>

<h4 id="example-1">Example 1</h4>

<p>Get Most Recent Data</p>

<pre><code class="language-python">url = '{}/api/v2/user/_/application/{}/environment/{}/data'.format(base_url,api_key,environment_id)

r = requests.get(url, auth=(username,password) )

if not r.status_code==200:
	raise Exception('an error occurred')

for data in r.json()['message']['data']:
	print data['time'] + '\t\t' + str(data['derived_sensors']['temperature']['value'])	
</code></pre>

<p>outputs:</p>

<pre><code>2015-10-27T00:11:55.922Z		24.3639510091
2015-10-27T00:11:45.426Z		24.5896988932
2015-10-27T00:11:34.938Z		24.4411124674
2015-10-27T00:11:24.438Z		24.2773323568
2015-10-27T00:11:13.933Z		24.4989135742
2015-10-27T00:11:03.426Z		24.3469091797
2015-10-27T00:10:52.928Z		24.5173982747
2015-10-27T00:10:42.438Z		24.3765844727
2015-10-27T00:10:31.935Z		24.5652490234

</code></pre>

<h4 id="example-2">Example 2</h4>

<p>Page Through All Data</p>

<pre><code class="language-python">url = '{}/api/v2/user/_/application/{}/environment/{}/data'.format(base_url,api_key,environment_id)

params = {}

while True:

	r = requests.get(url, auth = (username,password), params=params )
	
	if not r.status_code == 200:
		raise Exception('an error occured')

	dataCollection = r.json()['message']['data']

	if len(dataCollection) == 0:
		break

	for data in dataCollection:
		print data['time'] + '\t' + str(data['derived_sensors']['temperature']['value'])

	params['end'] = data['time']

</code></pre>

<h4 id="example-3">Example 3</h4>

<p>Poll For Data</p>

<pre><code class="language-python">
	url = '{}/api/v2/user/_/application/{}/environment/{}/data'.format(base_url,api_key,environment_id)

	params = {"order": "ascending",
	          "start": datetime.datetime.utcnow().isoformat() }

	while True:

		r = requests.get(url, auth = (username,password), params=params )

		if not r.status_code == 200:
			raise Exception('an error occured')

		dataCollection = r.json()['message']['data']

		for data in dataCollection:

			print data['time'] + '\t' + str(data['derived_sensors']['temperature']['value'])


		if len(dataCollection) &gt; 0:
			params['start'] = data['time']


		time.sleep(60*15) # pause 15 minutes and poll again
</code></pre>

<h3 id="get-application-info">Get Application Info</h3>

<h4 id="url-3">URL</h4>

<pre><code>GET https://senseai.io/api/v2/user/:user_id/application/:application_id
</code></pre>

<h4 id="response-3">Response</h4>

<p>example response message</p>

<pre><code class="language-json">{
    "application": {
      "name": "Foo",
      "api_key": "a673b59c13f703a461bfd3b4e7244302",
      "user_id": "f507b1fa6bb4916b555816e89e7cea03",
      "configuration": {
        "master_switch": true,
        "collection_rate": 20,
        "post_diagnostic_data": false
      },
    }
 }
 ```

### Change Application-Level Remote Configuration

Certain SDK parameters can be adjusted in the field, this should be done using the following:

#### URL

</code></pre>
<p>PUT https://senseai.io/api/v2/user/:user_id/application/:application_id/configure<br />
```</p>

<h4 id="request-body">Request Body</h4>

<p>example request body</p>

<pre><code>{
	"master_switch": true,
	"collection_rate": 20,
	"post_diagnostic_data": false
}
</code></pre>

        </section>

        <aside id="sidebar">

        </aside>
      </div>
    </div>


  </body>
</html>
