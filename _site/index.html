<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/fonts.css" media="print">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <link rel="stylesheet" type="text/css" href="stylesheets/syntax.css" media="screen">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Sense AI Documentation</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <img src="//d3r46qqpc6jz4w.cloudfront.net/senseai/SenseAi_logo.svg">
        <h2>API/SDK Documentation</h2>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1 id="api-documentation">API Documentation</h1>

<h2 id="general">General</h2>

<h3 id="conventions">Conventions</h3>

<h4 id="authentication">Authentication</h4>

<p>Where required, Basic Auth is used for user/developer level api access.</p>

<h4 id="time">Time</h4>

<p>Where timestamps are required either an ISO-8601 date string or a milliseconds-since-epoch(UTC), can be used interchangeably</p>

<h3 id="documentation-code-examples">Documentation Code Examples</h3>

<p>Throughout the API documentation we use the python(2) language to illustrate example usage.  For the examples to work the following imports are necessary:</p>

<pre><code class="language-python">import requests
import time
import datetime
</code></pre>

<p>We use <a href="http://docs.python-requests.org/en/latest/">requests</a> for the http library in these examples, the features used are expected to be present in most mature http libraries in popular languages.</p>

<h3 id="resource-descriptors">Resource Descriptors</h3>

<p>It is useful to too look at how SenseAI’s backend resources are organized, in order to understand the possibilites for resource access.  The resource relationships visible to the developer can be summed up as follows:</p>

<p><strong>users</strong> <em>have</em> <strong>applications</strong> : a user who is a developer can create applications(which represent a mobile device application which embeds an SDK), each of these are identified by an api_key, which are used to initiate the SDK along with the user_id</p>

<p><strong>application</strong> <em>have</em> <strong>environments</strong> : for each application, each device which uses an instance of the SDK is referred to as an environment, this environment tracks and identifies the mobile devices</p>

<p><strong>user</strong> <em>have</em> <strong>environments</strong> : users can link environments to their account through a pin challenge, this is used for individual app users to view their own data from the usage of senseAI APIs</p>

<p><strong>environments</strong> <em>have</em> <strong>data</strong> : each environment generates timestamped data</p>

<p>These relationships create the following possible resource descriptors:</p>

<p><code>/user/:user_id/</code><br />
<code>/user/:user_id/environment/:environment_id/</code><br />
<code>/user/:user_id/environment/:environment_id/data</code><br />
<code>/user/:user_id/environments</code><br />
<code>/user/:user_id/application/:application_id/</code><br />
<code>/user/:user_id/applications</code><br />
<code>/user/:user_id/application/:application_id/environment/:environment_id</code><br />
<code>/user/:user_id/application/:application_id/environment/:environment_id/data</code><br />
<code>/user/:user_id/application/:application_id/environments</code></p>

<h3 id="response-envelope">Response Envelope</h3>

<p>All response bodies are JSON encoded.  All JSON responses have a standard response envelope, that can be used to obtain meta-data about the response, in addition to the message payload.  An example for <code>GET /user/_</code> is seen below.</p>

<h4 id="example-response">Example Response</h4>

<pre><code class="language-json">{
  "links": {
    "self": "https://senseai-staging.com/api/v2/user/_/"
  },
  "status": {
    "code": 200,
    "text": "OK"
  },
  "error": null,
  "message": {
    "user": {
      "id": "f507b1fa6bb4916b555816e89e7cea03",
      "email": "foo@bar.com",
      "roles": [
        "user",
        "developer:basic"
      ],
      "unit_preference": "imperial",
      "created": 1432655398966,
    }
  }
}
</code></pre>

<h4 id="response-envelope-keys">Response Envelope Keys</h4>

<table>
  <thead>
    <tr>
      <th><strong>key</strong></th>
      <th><strong>description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>links.self</td>
      <td>a canonical version of the resource being accessed</td>
    </tr>
    <tr>
      <td>links.next</td>
      <td>if the resource has multiple parts, the link to the next part</td>
    </tr>
    <tr>
      <td>status.code</td>
      <td>same as the http response status code</td>
    </tr>
    <tr>
      <td>status.text</td>
      <td>the description of the http response status code</td>
    </tr>
    <tr>
      <td>error</td>
      <td>if an error occurred, a description of that error</td>
    </tr>
    <tr>
      <td>message</td>
      <td>the payload of the resource accessed (typically this is what you want)</td>
    </tr>
  </tbody>
</table>

<h3 id="pagination">Pagination</h3>

<p>For large collections of resources pagination is necessary.  Two query params control pagination in resources with plurality: <code>limit</code> determines the number of items returned at a time, <code>offset</code> is the id of the last item obtained by the caller.  If the <code>links.next</code> field exists in the response body, that link (constructed using limit and offset) can be followed in order to obtain the next set of items.  Pagination terminates when links.next is undefined.</p>

<h4 id="example-code-for-pagination">Example Code For Pagination</h4>

<h2 id="list-device-compatibility">List Device Compatibility</h2>

<h4 id="url">URL</h4>

<pre><code>GET https://senseai.io/api/v2/device/compat
</code></pre>

<h4 id="options">Options</h4>

<table>
  <thead>
    <tr>
      <th>query param</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>onlyTempV2</td>
      <td>only show entries which are calibrated V2 Temperature Model</td>
    </tr>
  </tbody>
</table>

<h4 id="response">Response</h4>

<p>example response message</p>

<pre><code class="language-json">[
	{
		"id":"23bb76f0-482b-11e5-a230-95b571d65c97",
		"name":"OnePlus One",
		"osVersion":"&lt;5.0.0",
	}, ...
]
</code></pre>

<h4 id="example-code">Example Code</h4>

<pre><code class="language-python">url = '{}/device/compat'.format(base_url)
params = { 'onlyTempV2' : 'yes' }

r = requests.get(url, params=params)

if not r.status_code==200:
	raise Exception('an error occurred')

devices = r.json()['message']['devices']

print 'Supported Devices'

for device in devices:
	print '\t' + device['name'] + ' ' + device['osVersion']
</code></pre>

<p>outputs:</p>

<pre><code>Supported Devices
	Samsung Galaxy S5 4.4.2
	Samsung Galaxy S5 &gt;=5.0
	Samsung Galaxy S5 4.4.4
	Samsung Galaxy S4  *
</code></pre>

<h2 id="list-active-environments-device-clients">List Active Environments (Device Clients)</h2>

<h4 id="url-1">URL</h4>

<pre><code>GET https://senseai.io/api/v2/user/:user_id/application/:application_id/environments
</code></pre>

<h4 id="response-1">Response</h4>

<p>example response message</p>

<pre><code class="language-json">[
	{
	  "id": "63d41b25c634c6aef3852d3ecd03879e.FED2E1F1F1CE09667A891A55E1E7D1DA",
	  "updated": 1445871149421,
	  "model": "t0lte",
	  "device_id": "2bb9f350-4203-11e5-b07c-71c60df92d2d",
	  "sdk_version": "0.6.0",
	  "api_key": "63d41b25c634c6aef3852d3ecd03879e",
	  "client_id": "FED2E1F1F1CE09667A891A55E1E7D1DA",
	  "timestamp": 1445867995878,
	  "commercial_name": "Samsung Galaxy Note2",
	  "os_version": "4.1.2"
	},
	...
]
</code></pre>

<h4 id="example">Example</h4>

<pre><code class="language-python">url = '{}/api/v2/user/_/application/{}/environments'.format(base_url,api_key)

r = requests.get(url,auth = (username,password))

if not r.status_code==200:
	raise Exception('an error occured')

environments = r.json()['message']['environments']

for environment in environments:
	print str(environment['id']) + '\t' + str(environment['commercial_name']) + '\t' + str(environment['model'])
</code></pre>

<p>outputs:</p>

<blockquote>
  <p>63d41b25c634c6aef3852d3ecd03879e.DF5310D424EC16A00968A1EEEECF0004	Samsung Galaxy S3 Mini	goldenvess3g<br />
63d41b25c634c6aef3852d3ecd03879e.E31487BC32B59A97C5CF0BA8668C42DF	Samsung Galaxy S5	kltevzw<br />
63d41b25c634c6aef3852d3ecd03879e.E668B385B50BE3ED3B4A128F6A3D2455	Samsung Galaxy S4	jflte<br />
63d41b25c634c6aef3852d3ecd03879e.EAD355A4A9281EEA4B8B4440BC913064	Samsung Galaxy S3	d2vzw</p>
</blockquote>

<h2 id="query-data">Query Data</h2>

<h4 id="url-2">URL</h4>

<pre><code>GET https://senseai.io/api/v2/user/:user_id/application/:application_id/environment/:environment_id/data
</code></pre>

<h4 id="options-1">Options</h4>

<table>
  <thead>
    <tr>
      <th>parameter</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>start</strong></td>
      <td>beginning of time indexed window (ISO or unix time allowed)</td>
    </tr>
    <tr>
      <td><strong>end</strong></td>
      <td>end of time indexed window</td>
    </tr>
    <tr>
      <td><strong>limit</strong></td>
      <td>pagination: the number of data points to return (default is 20, max is 100)</td>
    </tr>
    <tr>
      <td><strong>order</strong></td>
      <td>‘descending’ or ‘ascending’ (default is descending, accepts any abbreviations)</td>
    </tr>
  </tbody>
</table>

<h4 id="response-2">Response</h4>

<p>example response message:</p>

<pre><code class="language-json">[
	{  
	   "environment_id":"63d41b25c634c6aef3852d3ecd03879e.E668B385B50BE3ED3B4A128F6A3D2455",
	   "time":"2015-10-26T18:38:05.136Z",
	   	"location":{  
	      "longitude":3.6662295,
	      "latitude":43.3977541,
	      "accuracy":35.19900131225586
	   },
	   "derived_sensors":{  
	      "temperature":{  
	         "value":20.622745768229166,
	         "confidence":0.9999999963628308
	      }
	   },
	   "normalized_sensors":{  
	      "lux":{  
	         "value":0.36372525855
	      }
	   },
	   "raw_sensors":{  
	      "average_sman_pressure":{  
	         "value":1012.5
	      },
		  "average_sman_humidity":{  
		         "value":73.55426205721768
		  }
	   }
	}
	...
]
</code></pre>

<h4 id="example-1">Example 1</h4>
<p>##### Get Most Recent Data</p>

<pre><code class="language-python">url = '{}/api/v2/user/_/application/{}/environment/{}/data'.format(base_url,api_key,environment_id)

r = requests.get(url, auth=(username,password) )

if not r.status_code==200:
	raise Exception('an error occurred')

dataCollection = r.json()['message']['data']

for data in dataCollection:
	print data['time'] + ' ' + str(data['derived_sensors']['temperature']['value'])	
</code></pre>

<p>outputs:</p>

<pre><code>2015-10-26T23:03:27.951Z 15.751167806
2015-10-26T23:03:17.451Z 15.742417806
2015-10-26T23:03:06.965Z 15.733667806
2015-10-26T23:02:56.457Z 15.724917806
2015-10-26T23:02:45.956Z 15.716167806
2015-10-26T23:02:35.455Z 15.707417806
2015-10-26T23:02:24.955Z 15.7003344727
2015-10-26T23:02:14.451Z 15.698667806
2015-10-26T23:02:03.956Z 15.693667806
2015-10-26T23:01:53.458Z 15.684917806
2015-10-26T23:01:42.951Z 15.676167806
2015-10-26T23:01:32.481Z 15.667417806
2015-10-26T23:01:21.951Z 15.658667806
2015-10-26T23:01:11.450Z 15.649917806
2015-10-26T23:01:00.959Z 15.641167806
2015-10-26T23:00:50.460Z 15.632417806
2015-10-26T23:00:39.938Z 15.623667806
2015-10-26T23:00:29.450Z 15.614917806
2015-10-26T23:00:18.943Z 15.606167806
2015-10-26T23:00:08.432Z 15.5995011393

</code></pre>

<h4 id="example-2">Example 2</h4>
<p>##### Page Through All Data</p>

<pre><code class="language-python">url = '{}/api/v2/user/_/application/{}/environment/{}/data'.format(base_url,api_key,environment_id)

params = {}

while True:

	r = requests.get('http://senseai-staging.com/api/v2/user/_/application/'+ api_key + '/environment/' + environment_id + '/data', auth = (username,password), params=params )
	
	if not r.status_code == 200:
		raise Exception('an error occured')

	dataCollection = r.json()['message']['data']

	if len(dataCollection) == 0:
		break

	for data in dataCollection:
		print data['time'] + '\t' + str(data['derived_sensors']['temperature']['value'])

	params['end'] = data['time']

</code></pre>

<h4 id="example-3">Example 3</h4>
<p>##### Poll For Data</p>

<pre><code class="language-python">
	url = '{}/api/v2/user/_/application/{}/environment/{}/data'.format(base_url,api_key,environment_id)

	params = {"order": "ascending",
	          "start": datetime.datetime.utcnow().isoformat() }

	while True:

		r = requests.get('http://senseai-staging.com/api/v2/user/_/application/'+ api_key + '/environment/' + environment_id + '/data', auth = (username,password), params=params )

		if not r.status_code == 200:
			raise Exception('an error occured')

		dataCollection = r.json()['message']['data']

		for data in dataCollection:

			print data['time'] + '\t' + str(data['derived_sensors']['temperature']['value'])


		if len(dataCollection) &gt; 0:
			params['start'] = data['time']


		time.sleep(60*5)
</code></pre>

        </section>

        <aside id="sidebar">

        </aside>
      </div>
    </div>


  </body>
</html>
